<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../ptm-session/ptm-session.html">

<dom-module id="ptm-session-list">
  <style>
  </style>
  <template>
    <paper-material>
      <template is="dom-repeat" items="{{sessions}}" filter="isSession">
        <ptm-session session-id="{{item.id}}" window-id="{{winId}}" sessions="{{item.fields}}" title="{{item.title}}"></ptm-session>
      </template>
    </paper-material>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'ptm-session-list',
    properties: {
      sessions: {
        type: Array,
        value: []
      }
    },
    isSession: function(item) {
      return !!item.session;
    },
    renameProject: function(e, detail, sender) {
      // TODO: implement
      // chrome.runtime.sendMessage({
      //   command: 'renameProject',
      //   projectId: sender.entry.id,
      //   title: detail.newTitle
      // });
    },
    removeProject: function(e, detail, sender) {
      chrome.runtime.sendMessage({
        command: 'removeProject',
        projectId: sender.entry.id
      });
    },
    reload: function() {
      chrome.runtime.sendMessage({
        command: 'update',
        // forceReload: force_reload
        forceReload: true
      }, function() {
console.log('reloaded');
        // this.sessions = ProjectManager.projects;
      });
    },
    set_dialog_title: function(title) {
      // $scope.dialog_title = title;
    },
    ready: function() {
      var that = this;
      // chrome.runtime.onMessage.addListener(function(msg, sender) {
      //   console.log('ptm-session-list event received:', msg);
      //   if (msg.command == 'app-ready') {
      //     that.projects = ProjectManager.projects;
      //   }
      // });
    }
  });
</script>
