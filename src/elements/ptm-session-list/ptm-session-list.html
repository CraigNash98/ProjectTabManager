<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../ptm-list-behavior/ptm-list-behavior.html">
<link rel="import" href="../ptm-session/ptm-session.html">

<dom-module id="ptm-session-list">
  <style>
    *:focus {
      outline: none;
    }
  </style>
  <template>
    <template id="repeat" is="dom-repeat" items="[[projects]]" filter="filter" sort="sort">
      <ptm-session
        project="{{item}}"
        project-id="[[item.id]]"
        session-id="[[item.session.id]]"
        win-id="[[item.session.winId]]"
        session-title="[[item.session.title]]"
        project-title="[[item.title]]"
        fields="[[item.fields]]"
        expanded="[[_isActive(item.session.winId)]]"
        tabindex="0">
      </ptm-session>
    </template>
  </template>
</dom-module>

<script>
  'use strict'
  Polymer({
    is: 'ptm-session-list',
    behaviors: [
      PtmListBehavior
    ],
    properties: {
      activeWinId: {
        type: Number,
        value: 0
      }
    },
    filter: function(item) {
      return !!item.session;
    },
    sort: function(item1, item2) {
      var winId1 = item1.session && item1.session.winId ? true : false;
      var winId2 = item2.session && item2.session.winId ? true : false;
      if (winId1 === winId2) {
        return 0;
      } else if (winId1) {
        return -1;
      } else {
        return 1;
      }
    },
    _isActive: function(winId) {
      if (this.projectManager) {
        var activeWinId = this.projectManager.getActiveWindowId();
        if (activeWinId == winId) {
          return true;
        }
      }
      return false;
    }
  });
</script>
