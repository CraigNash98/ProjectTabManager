<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../ptm-list-behavior/ptm-list-behavior.html">
<link rel="import" href="../ptm-project/ptm-project.html">

<dom-module id="ptm-project-list">
  <style>
  </style>
  <template>
    <template id="repeat" is="dom-repeat" items="{{projectManager.projects}}" filter="filter">
      <ptm-project
        project="{{item}}"
        project-id="{{item.id}}"
        project-title="{{item.title}}"
        fields="{{item.fields}}"
        query="{{query}}"
        expanded="{{_isSearching(query)}}"
        on-open-project="open"
        on-rename-project="rename"
        on-remove-project="remove">
      </ptm-project>
    </template>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'ptm-project-list',
    behaviors: [
      PtmListBehavior
    ],
    filter: function(item) {
      if (this.query.length < 2) {
        return !!item.bookmark;
      } else {
        var matched = item.title.toLowerCase().indexOf(this.query.toLowerCase()) > -1;
        return matched || this.matchedBookmarks > 0;
      }
    },
    _isSearching: function(query) {
      return query == '' ? false : true;
    },
    rename: function(e) {
      // TODO: implement
      // chrome.runtime.sendMessage({
      //   command: 'renameProject',
      //   projectId: e.detail.projectId,
      //   title: detail.newTitle
      // });
    },
    remove: function(e) {
      chrome.runtime.sendMessage({
        command: 'removeProject',
        projectId: e.detail.projectId
      });
    }
  });
</script>
