<link rel="import" href="../../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../ptm-project-list/ptm-project-list.html">
<link rel="import" href="../ptm-session-list/ptm-session-list.html">

<polymer-element name="ptm-projects-pane">
  <template>
    <link rel="stylesheet" href="ptm-projects-pane.css">
    <core-toolbar>
      <core-icon-button icon="menu" on-click="{{toggle}}"></core-icon-button>
      <paper-input label="Search" value="{{query}}" flex></paper-input>
      <core-icon-button icon="refresh" on-click="{{reload}}"></core-icon-button>
    </core-toolbar>
    <paper-tabs selected="{{tab}}">
      <paper-tab>
        Sessions
      </paper-tab>
      <paper-tab>
        Projects
      </paper-tab>
    </paper-tabs>
    <core-pages id="main" selected="{{tab}}">
      <ptm-session-list projects="{{projects}}" sessions="{{sessions}}" query="{{query}}"></ptm-session-list>
      <ptm-project-list projects="{{projects}}" query="{{query}}"></ptm-project-list>
    </core-pages>
  </template>
  <script>
    Polymer('ptm-projects-pane', {
      publish: {
        projects: {
          value: [],
          reflect: false
        },
        sessions: {
          value: [],
          reflect: false
        },
      },
      tab: 0,
      created: function() {
        this.projects = [];
        this.sessions = [];
      },
      renameProject: function(e, detail, sender) {
        // TODO: implement
        // chrome.runtime.sendMessage({
        //   command: 'renameProject',
        //   projectId: sender.entry.id,
        //   title: detail.newTitle
        // });
      },
      removeProject: function(e, detail, sender) {
        chrome.runtime.sendMessage({
          command: 'removeProject',
          projectId: sender.entry.id
        });
      },
      reload: function() {
        chrome.runtime.sendMessage({
          command: 'update',
          // forceReload: force_reload
          forceReload: true
        }, function() {
console.log('reloaded');
          this.sessions = SessionManager.projects;
        });
      },
      set_dialog_title: function(title) {
        // $scope.dialog_title = title;
      },
      ready: function() {
        var that = this;
        // chrome.runtime.onMessage.addListener(function(msg, sender) {
        //   console.log('ptm-session-list event received:', msg);
        //   if (msg.command == 'app-ready') {
        //     that.projects = ProjectManager.projects;
        //   }
        // });
      }
    });
  </script>
</polymer-element>
